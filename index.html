<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tambola Tickets</title>
  </head>
  <style>
    table,
    td {
      border: 1px solid black;
      border-collapse: collapse;
    }

    td,
    tr {
      width: 30px;
      height: 30px;
      padding: 15px;
      font-size: 20px;
    }

    table {
      margin: 100px;
    }

    h1 {
      text-align: center;
    }

    .center {
      margin-left: auto;
      margin-right: auto;
    }
  </style>
  <body>
    <div>
      <h1>Your Tambola ticket is ready:</h1>
      <table class="center">
        <tr>
          <td>1</td>
          <td></td>
          <td>21</td>
          <td></td>
          <td>42</td>
          <td>53</td>
          <td></td>
          <td>76</td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td>12</td>
          <td></td>
          <td>34</td>
          <td></td>
          <td>58</td>
          <td>65</td>
          <td></td>
          <td>83</td>
        </tr>
        <tr>
          <td>4</td>
          <td></td>
          <td>27</td>
          <td></td>
          <td>49</td>
          <td></td>
          <td></td>
          <td>77</td>
          <td>88</td>
        </tr>
      </table>
    </div>

    <script>
      const count = new Array(9).fill(0);

      const getRandomInt = (min, max) =>
        Math.floor(Math.random() * (max - min + 1)) + min;

      const generateFirstTwoRows = () => {
        let rows = [];
        for (let i = 0; i < 5; i++) {
          let temp = getRandomInt(1, 9);
          while (rows.includes(temp)) {
            temp = getRandomInt(1, 9);
          }
          rows.push(temp);
          count[temp - 1]++;
        }
        return rows.sort();
      };

      const generateLastRow = () => {
        let rows = [];
        for (let i = 0; i < count.length; i++) {
          if (count[i] === 0) {
            count[i]++;
            rows.push(i + 1);
          }
        }
        // console.log(rows);
        let prevRowLength = rows.length;

        for (let i = 0; i < 5 - prevRowLength; i = i + 1) {
          let temp = getRandomInt(1, 9);
          while (rows.includes(temp) || count[temp - 1] >= 3) {
            // console.log(temp, rows.includes(temp));
            temp = getRandomInt(1, 9);
          }
          rows.push(temp);
          count[temp - 1]++;
        }
        // console.log(rows);
        return rows.sort();
      };

      let ticketRows = [
        generateFirstTwoRows(),
        generateFirstTwoRows(),
        generateLastRow(),
      ];
      //   console.log(ticketRows[0], ticketRows[1], ticketRows[2]);

      const generateNumbers = () => {
        let ticketNumbers = [];
        for (let i = 0; i < ticketRows.length; i++) {
          let numbersRow = new Array(9).fill(-1);
          for (let j = 0; j < ticketRows[i].length; j++) {
            let temp;
            if (i === 0) {
              if (ticketRows[i][j] === 9) temp = getRandomInt(80, 90);
              else
                temp = getRandomInt(
                  ticketRows[i][j] * 10 - 9,
                  ticketRows[i][j] * 10 - 1
                );
            } else {
              if (ticketRows[i][j] === 9) {
                temp = getRandomInt(80, 90);
                while (
                  (i === 1 &&
                    ticketNumbers[i - 1][8] === temp &&
                    ticketNumbers[i - 1][8] !== -1) ||
                  (i === 2 &&
                    ticketNumbers[i - 1][8] === temp &&
                    ticketNumbers[i - 1][8] !== -1 &&
                    ticketNumbers[i - 2][8] === temp &&
                    ticketNumbers[i - 2][8] !== -1)
                ) {
                  console.log(i, temp, ticketNumbers[i - 1][8]);
                  temp = getRandomInt(80, 90);
                }
              } else {
                temp = getRandomInt(
                  ticketRows[i][j] * 10 - 9,
                  ticketRows[i][j] * 10 - 1
                );
                console.log(
                  temp,
                  ticketRows[i][j],
                  ticketRows[i - 1][ticketRows[i][j] - 1],
                  i >= 2 && ticketRows[i - 2][ticketRows[i][j] - 1]
                );
                while (
                  (i === 1 &&
                    ticketNumbers[i - 1][ticketRows[i][j] - 1] === temp &&
                    ticketNumbers[i - 1][ticketRows[i][j] - 1] !== -1) ||
                  (i === 2 &&
                    ticketNumbers[i - 1][ticketRows[i][j] - 1] === temp &&
                    ticketNumbers[i - 1][ticketRows[i][j] - 1] !== -1 &&
                    ticketNumbers[i - 2][ticketRows[i][j] - 1] === temp &&
                    ticketNumbers[i - 2][ticketRows[i][j] - 1] !== -1)
                ) {
                  console.log(
                    i,
                    temp,
                    ticketNumbers[i - 1][ticketRows[i][j] - 1]
                  );
                  temp = getRandomInt(
                    ticketRows[i][j] * 10 - 9,
                    ticketRows[i][j] * 10 - 1
                  );
                }
              }
            }
            numbersRow[ticketRows[i][j] - 1] = temp;
          }
          ticketNumbers.push(numbersRow);
        }
        return ticketNumbers;
      };

      const ticketNumbers = generateNumbers();
      console.log(ticketNumbers[0], ticketNumbers[1], ticketNumbers[2]);

      const sortTicketNumbers = () => {
        for (let i = 1; i < ticketNumbers.length; i++) {
          for (j = 0; j < ticketNumbers[i].length; j++) {}
        }
      };
    </script>
  </body>
</html>
